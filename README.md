# RandClusterModel — разработка Planet

## Обзор архитектуры
Приложение строит интерактивную гексагональную сферу, где террейн генерируется на CPU и отображается через OpenGL. Qt отвечает за окна и панель настроек, а вычислительные и графические части вынесены в отдельные контроллеры и рендерер. Работа разделена на уровни: UI → контроллер сцены → рендерер/граф сцены → GPU.

## Классы
- **MainWindow** (`Planet/MainWindow.*`): создаёт центральный `HexSphereWidget`, панель настроек `PlanetSettingsPanel`, тулбар с уровнями разбиения и команды сброса/очистки выбора. Управляет док-панелью и пробрасывает сигналы панели в виджет. 
- **HexSphereWidget** (`Planet/HexSphereWidget.*`): OpenGL-виджет, сочетающий контроллер сцены, рендерер и граф сцены. Отвечает за инициализацию GL, обработку ввода (мышь, колесо, клавиши), управление камерой, выбор ячеек/объектов, обновление буферов и таймер анимации воды. 
- **HexSphereSceneController** (`Planet/HexSphereSceneController.*`): управляет моделью гексасферы и CPU-мешем террейна. Хранит выбранные ячейки, настраивает генераторы (`ITerrainGenerator` и производные), обновляет параметры сглаживания/инсетов, пересобирает модель и подготавливает данные для проволоки, подсветки, пути и воды. 
- **HexSphereRenderer** (`Planet/HexSphereRenderer.*`): инкапсулирует OpenGL-ресурсы и шейдеры. Загружает буферы террейна, проволоки, контура выбора, пути и воды; рисует сцену, подсвеченные сущности (`SceneEntity`/`scene::SceneGraph`) и окружение (env-cubemap). Ведёт счётчики производительности через `PerformanceStats`. 
- **Вспомогательные модули**: `TerrainGenerator`, `TerrainTessellator`, `HexSphereModel`, `PathBuilder`, `PerlinNoise`, конвертеры моделей и примеры/тесты в `Planet/tests` помогают генерировать ландшафт, строить пути и загружать внешние модели.

## Data Flow
1. **UI и ввод**: `MainWindow` создаёт `HexSphereWidget`, подключает `PlanetSettingsPanel` и пробрасывает изменения уровня разбиения, параметров террейна и визуализации.
2. **Контроллер сцены**: виджет передаёт события в `HexSphereSceneController`, который перестраивает гексасферу, обновляет выбранные ячейки, запускает генераторы и готовит CPU-данные (меши, проволока, контуры, поли-лайны путей, геометрию воды).
3. **Рендерер**: `HexSphereWidget` передаёт подготовленные данные в `HexSphereRenderer`, который загружает их в OpenGL-буферы, выставляет матрицы камеры и рисует террейн, сущности сцены и отладочные элементы.
4. **Обратная связь**: виджет измеряет производительность через `PerformanceStats`, обновляет HUD-текст и, при выборе ячеек/объектов, синхронизирует выделение между сценой и графом сцены.

## Глобальная иерархия элементов
- `Planet/` — основное приложение Qt/OpenGL: UI (`MainWindow`, `PlanetSettingsPanel`), виджет (`HexSphereWidget`), рендер (`HexSphereRenderer`), контроллер (`HexSphereSceneController`), геометрия/генераторы (`HexSphereModel`, `TerrainGenerator`, `TerrainTessellator`, `PerlinNoise`, `PathBuilder`), сцена (`scene/SceneGraph`, `SceneEntity`), загрузчик моделей (`ModelHandler`), ресурсы (`Planet.qrc`, `scene/`, `tree.obj`), тесты/примеры (`tests/`, `model_cache_test.cpp`).
- Корень репозитория — вспомогательные скрипты и тестовые файлы верхнего уровня.
